using System.Collections.Generic;
using System.IO;
using NUnit.Framework;
using TestTextEditorViewModel.DataProviders;
using TestTextEditorViewModel.TestData;
using TestTools.Utils;
using TextEditor.Highlight;

namespace TestTextEditorViewModel.Tests
{
    [TestFixture]
    public class OpenTests : BaseTests
    {
        [Test]
        [TestCaseSource(typeof(FileProviders), nameof(FileProviders.ResourceFilesHighlightProvider))]
        public void OpenFileHighlightTest(
            string fileName,
            ISet<string> wordsToHighlight)
        {
            TestViewModel.OpenFile(fileName);
            CollectionAssert.AreEquivalent(wordsToHighlight, TestViewModel.WordsToHighlight,
                "Words to highlight is wrong");
        }
        
        [Test]
        [TestCaseSource(typeof(FileProviders), nameof(FileProviders.ResourceFilesProvider))]
        public void OpenFileCurrentOpenedTest(
            string fileName)
        {
            TestViewModel.OpenFile(fileName);
            Assert.AreEqual(fileName, TestViewModel.CurrentOpenedFile,
                "File name is wrong");
        }
        
        [Test]
        [TestCaseSource(typeof(FileProviders), nameof(FileProviders.ResourceFilesProvider))]
        public void OpenFileContentTest(
            string fileName)
        {
            TestViewModel.OpenFile(fileName);
            Assert.AreEqual(File.ReadAllText(fileName), TestViewModel.Text,
                "Text is wrong");
        }

        [Test]
        public void OpenAfterOpenTest()
        {
            TestViewModel.OpenFile(BaseFiles.CsharpFile);
            CollectionAssert.AreEquivalent(BasicWordsToHighlight.CsWords, TestViewModel.WordsToHighlight,
                "1. Words to highlight is wrong");
            Assert.AreEqual(BaseFiles.CsharpFile, TestViewModel.CurrentOpenedFile,
                "1. File name is wrong");
            Assert.AreEqual(File.ReadAllText(BaseFiles.CsharpFile), TestViewModel.Text,
                "1. Text is wrong");
            
            TestViewModel.OpenFile(BaseFiles.JavaFile);
            CollectionAssert.AreEquivalent(BasicWordsToHighlight.JavaWords, TestViewModel.WordsToHighlight,
                "2. Words to highlight is wrong");
            Assert.AreEqual(BaseFiles.JavaFile, TestViewModel.CurrentOpenedFile,
                "2. File name is wrong");
            Assert.AreEqual(File.ReadAllText(BaseFiles.JavaFile), TestViewModel.Text,
                "2. Text is wrong");
        }
        
        [Test]
        public void OpenAfterSaveAsTest()
        {
            TestViewModel.SetText(TextHelper.GetText());
            TestViewModel.SaveAsFile(BaseFiles.ToSaveCsFile);
            CollectionAssert.AreEquivalent(BasicWordsToHighlight.CsWords, TestViewModel.WordsToHighlight,
                "1. Words to highlight is wrong");
            Assert.AreEqual(BaseFiles.ToSaveCsFile, TestViewModel.CurrentOpenedFile,
                "1. File name is wrong");
            Assert.AreEqual(File.ReadAllText(BaseFiles.ToSaveCsFile), TestViewModel.Text,
                "1. Text is wrong");
            
            TestViewModel.OpenFile(BaseFiles.JavaFile);
            CollectionAssert.AreEquivalent(BasicWordsToHighlight.JavaWords, TestViewModel.WordsToHighlight,
                "2. Words to highlight is wrong");
            Assert.AreEqual(BaseFiles.JavaFile, TestViewModel.CurrentOpenedFile,
                "2. File name is wrong");
            Assert.AreEqual(File.ReadAllText(BaseFiles.JavaFile), TestViewModel.Text,
                "2. Text is wrong");
        }

        [Test]
        public void OpenAfterSetTextTest()
        {
            TestViewModel.SetText(TextHelper.GetText());
            
            TestViewModel.OpenFile(BaseFiles.JavaFile);
            CollectionAssert.AreEquivalent(BasicWordsToHighlight.JavaWords, TestViewModel.WordsToHighlight,
                "Words to highlight is wrong");
            Assert.AreEqual(BaseFiles.JavaFile, TestViewModel.CurrentOpenedFile,
                "File name is wrong");
            Assert.AreEqual(File.ReadAllText(BaseFiles.JavaFile), TestViewModel.Text,
                "Text is wrong");
        }
    }
}